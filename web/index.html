<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF8">
  <title>Movie Graph</title>

  <script type="text/javascript" src="js/vis-network.min.js"></script>

  <script src="js/movies_1000.js"></script>
  <script src="js/talent_1000.js"></script>
  <script src="js/collections.js"></script>
  <script src="js/genres.js"></script>

  <style type="text/css">
    #graph {
      width: 800px;
      height: 800px;
      border: 1px solid lightgray;
    }
    #mynetwork {
      width: 600px;
      height: 400px;
      border: 1px solid lightgray;
    }
  </style>
  
</head>
<body>

<!-- <form onsubmit="searchFn(this)"> -->
  Search: <input type="text" id="search"><br>
  <input type="submit" value="Submit" onclick="searchFn(this)">
<!-- </form> -->

<div id="mynetwork"></div>

</body>
<script>
  var nodes, edges;
  // create a network
  var container = document.getElementById('mynetwork');
  

  function searchFn() {
    var searchValue = document.getElementById("search").value.toLowerCase();
    var subset = talent.filter(i => i['name'].toLowerCase().includes(searchValue))
    if (subset.length < 1) {
      console.error('no match');
    }
    console.log(subset[0]);
    addRootTalent(subset[0]);
    var data = {
      nodes: nodes,
      edges: edges
    };
    var options = {};
    var network = new vis.Network(container, data, options);
  }

  function addRootTalent(node) {
    nodes = [];
    edges = [];

    var id = 't' + node.talent_id
    nodes.push(Object.assign({id: id, label: node.name}, node));
    node.movies.forEach((movie) => {
      var to = addMovie(movie)
      if (to) {
        edges.push({from: id, to: to});  
      }
    });
  }

  function addMovie(movieId) {
    console.log('movieId: ',movieId);
    var movie = movies.find(m => m.id == movieId);
    if (!movie) return;
    nodes.push(Object.assign({label: movie.title}, movie))
    return movie.id;
  }
</script>
</html>